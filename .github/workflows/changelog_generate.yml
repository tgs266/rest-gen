name: Generate Changelog

on:
  pull_request:
    types:
      - opened

jobs:
  changelog:
    if: github.event.pull_request.base.ref == "main"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name }}
          ref: ${{ github.event.pull_request.head.ref }}
      - name: Get PR info
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_NUMBER: ${{ github.event.pull_request.number  }}
      - name: Get PR labels
        id: pr-labels
        uses: joerick/pr-labels-action@v1.0.6
      - name: Check for changelog folder
        run: mkdir -p changelog
      - name: Create unreleased folder
        run: mkdir -p changelog/unreleased
      - name: Write pr
        run: |
          touch "changelog/unreleased/PR-$PR_TITLE"
          echo "[($PR_NUMBER)[https://github.com/tgs266/rest-gen/pull/$PR_NUMBER]] $PR_TITLE" > "changelog/unreleased/PR-$PR_TITLE"
      - uses: EndBug/add-and-commit@v9
        with:
          default_author: github_actions
          message: Write Changelog
          committer_name: GitHub Actions
          committer_email: actions@github.com


# jobs:
#   release:
#     runs-on: ubuntu-latest
#     if: github.event.pull_request.merged == true
#     steps:
#       - uses: actions/checkout@v2

#       - name: Prepare repository
#         run: git fetch --unshallow --tags

#       - name: Use Node.js 12.x
#         uses: actions/setup-node@v1
#         with:
#           node-version: 12.x

#       - name: Cache node modules
#         uses: actions/cache@v1
#         with:
#           path: node_modules
#           key: yarn-deps-${{ hashFiles('yarn.lock') }}
#           restore-keys: |
#             yarn-deps-${{ hashFiles('yarn.lock') }}

#       - name: Create Release
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#         run: |
#           yarn install --frozen-lockfile
#           yarn build
#           npx auto shipit